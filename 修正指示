Codex ã¸ã®ä¿®æ­£ä¾é ¼

## ç›®çš„

GitHub Pages ã¯ **ãƒ‡ãƒ¢å°‚ç”¨ï¼ˆAPIã¯å©ã‹ãªã„ï¼‰**ã«ã™ã‚‹ã€‚

æœ¬ç•ªã¯ Vercel ã® /api/chat çµŒç”±ã§ OpenAI ã‚’å‘¼ã¶ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã« API ã‚­ãƒ¼ã‚’å…¥åŠ›ã•ã›ã‚‹ UI ã¯æ—¢å®šã§ã¯éè¡¨ç¤ºï¼ˆBYOK ã¯ä»»æ„ã§æœ‰åŠ¹åŒ–å¯èƒ½ï¼‰ã€‚

## å¤‰æ›´å¯¾è±¡

index.html

script.js

æ–°è¦ï¼š/api/chat.jsï¼ˆVercel Serverless Functionï¼‰

ä»»æ„ï¼šREADME.mdï¼ˆå°ç·šã®è¿½è¨˜ï¼‰

## ã‚„ã‚ŠãŸã„ã“ã¨ï¼ˆå®Ÿè£…è¦ä»¶ï¼‰

# 1. index.html ã®å†’é ­ã« ãƒ‡ãƒ¢åˆ¤å®šï¼‹Pagesã‚¬ãƒ¼ãƒ‰ã‚’è¿½åŠ 

?demo=1 ã®ã¨ãã®ã¿ãƒ‡ãƒ¢ã‚’æœ‰åŠ¹åŒ–ã—ã€APIå‘¼ã³å‡ºã—ã‚’ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆfetch ã®ãƒ©ãƒƒãƒ—ã§ /api ã¨ openai.com ã‚’æ‹’å¦ï¼‰ã€‚

*.github.io ã§ã¯ ãƒ‡ãƒ¢ä»¥å¤–ã‚’åœæ­¢ã—ã¦ã€æ¡ˆå†…æ–‡ã‚’è¡¨ç¤ºã€‚

# 2. script.js ã® OpenAIâ€œç›´å‘¼ã³â€ã‚’ç¦æ­¢ã—ã€sendChat() ã‚’ /api/chat POST ã«å¤‰æ›´ã€‚

ãƒ‡ãƒ¢æ™‚ã¯ mockChat() ã‚’è¿”ã™ã€‚

# 3. æ–°è¦ api/chat.js ã‚’è¿½åŠ ã—ã€ã‚µãƒ¼ãƒå´ã§ process.env.OPENAI_API_KEY ã‚’ä½¿ç”¨ã—ã¦ OpenAI ã‚’å‘¼ã¶ã€‚

æœªè¨­å®šæ™‚ã¯ 500 ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™ã€‚

# 4.ï¼ˆä»»æ„ï¼‰GET /api/chat ã§ { ok:true, hasKey:boolean } ã‚’è¿”ã™ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€‚

ï¼ˆä»»æ„ï¼‰ã‚­ãƒ¼å…¥åŠ›UIãŒã‚ã‚‹å ´åˆã¯ æ—¢å®šã§éè¡¨ç¤ºã«å¤‰æ›´ã—ã€?byok=1 ã®æ™‚ã ã‘è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†åˆ‡æ›¿ã€‚



## åˆ¶ç´„ãƒ»æ–¹é‡

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚­ãƒ¼ã‚’éœ²å‡ºã—ãªã„ï¼ˆNEXT_PUBLIC_ å¤‰æ•°ã¯ä½¿ã‚ãªã„ï¼‰ã€‚

æ—¢å­˜ã® UI/UX ã‚’å£Šã•ãªã„ï¼ˆãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®é–¢æ•°åã‚„æˆ»ã‚Šå€¤ã®å½¢ã¯ç¶­æŒï¼‰ã€‚

æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å¤‰æ›´ã¯ æœ€å°å·®åˆ†ã§ã€‚

## å—ã‘å…¥ã‚ŒåŸºæº–ï¼ˆå‹•ä½œç¢ºèªï¼‰

âœ… https://â€¦github.io/â€¦/?demo=1 ã§ UI ãŒå‹•ãã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã« /api ã‚„ openai.com ãŒå‡ºãªã„ã€‚

âœ… https://â€¦github.io/â€¦/ï¼ˆ?demo=1 ãªã—ï¼‰ã¯ ãƒ–ãƒ­ãƒƒã‚¯æ¡ˆå†…ãŒå‡ºã‚‹ã€‚

âœ… https://<app>.vercel.app ã§ OPENAI_API_KEY ã‚’è¨­å®šæ¸ˆã¿ãªã‚‰ã€ã‚­ãƒ¼å…¥åŠ›ãªã—ã§ä¼šè©±ã§ãã‚‹ã€‚

âœ… GET /api/chat ãŒ { ok:true, hasKey:true } ã‚’è¿”ã™ï¼ˆä»»æ„ï¼‰ã€‚

âœ… BYOKï¼ˆ?byok=1ï¼‰ã«ã™ã‚‹ã¨ã‚­ãƒ¼å…¥åŠ›UIãŒå‡ºã‚‹ï¼ˆä»»æ„ï¼‰ã€‚

## å¤‰æ›´å·®åˆ†ï¼ˆé››å½¢ï¼‰

1) index.htmlï¼ˆå†’é ­ã¸è¿½è¨˜ï¼‰

<script>
(() => {
  const u = new URL(location.href);
  const DEMO = u.searchParams.get('demo') === '1';
  const isPages = /\.github\.io$/.test(location.hostname) || location.hostname === 'github.io';
  window.__DEMO__ = DEMO;

  if (DEMO) {
    const _fetch = window.fetch.bind(window);
    window.fetch = (input, init) => {
      const s = String(input);
      if (s.includes('/api') || s.includes('openai.com')) {
        return Promise.reject(new Error('Demo mode blocks API calls'));
      }
      return _fetch(input, init);
    };
    document.documentElement.classList.add('demo');
  }

  if (isPages && !DEMO) {
    addEventListener('DOMContentLoaded', () => {
      document.body.innerHTML =
        '<h2>ğŸš« GitHub Pages ã¯ãƒ‡ãƒ¢å°‚ç”¨</h2><p><code>?demo=1</code> ã‚’ä»˜ã‘ã¦UIã®ã¿è©¦ã›ã¾ã™ã€‚æœ¬ç•ªã¯Vercelã¸ã€‚</p>';
    });
    throw new Error('Blocked on GitHub Pages (non-demo)');
  }
})();
</script>


2) script.jsï¼ˆç›´å‘¼ã³â†’/api çµŒç”±ï¼‹ãƒ‡ãƒ¢æ™‚ãƒ¢ãƒƒã‚¯ï¼‰

 async function sendChat(messages){
-  const r = await fetch('https://api.openai.com/v1/chat/completions', {
-    method: 'POST',
-    headers: {
-      'Content-Type': 'application/json',
-      Authorization: `Bearer ${state.config.apiKey}`,
-    },
-    body: JSON.stringify(requestBody),
-  });
+  if (window.__DEMO__) return mockChat(messages);
+  const r = await fetch('/api/chat', {
+    method: 'POST',
+    headers: { 'Content-Type': 'application/json' },
+    body: JSON.stringify({ messages }),
+  });
   return r.json();
 }

+async function mockChat(messages){
+  const last = messages?.at(-1)?.content ?? '';
+  return { choices: [{ message:{ role:'assistant',
+    content: `ã“ã‚Œã¯ãƒ‡ãƒ¢å¿œç­”ã§ã™ ğŸ‘‹\nå…¥åŠ›:ã€Œ${last.slice(0,60)}ã€\næœ¬ç•ªã¯Vercelã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã­ã€‚` } }] };
+}


3) æ–°è¦ api/chat.js

export default async function handler(req, res){
  if (req.method === 'GET') {
    return res.status(200).json({ ok: true, hasKey: Boolean(process.env.OPENAI_API_KEY) });
  }
  if (req.method !== 'POST') return res.status(405).end();

  const key = process.env.OPENAI_API_KEY;
  if (!key) return res.status(500).json({ error: 'OPENAI_API_KEY is not set' });

  const { messages, model = 'gpt-4o-mini' } = req.body || {};
  const r = await fetch('https://api.openai.com/v1/chat/completions', {
    method:'POST',
    headers:{ 'Content-Type':'application/json', Authorization:`Bearer ${key}` },
    body: JSON.stringify({ model, messages })
  });
  res.status(r.status).json(await r.json());
}

