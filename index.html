<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>FreshChat UI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
      (() => {
        const u = new URL(location.href);
        const DEMO = u.searchParams.get('demo') === '1';
        const BYOK = u.searchParams.get('byok') === '1';
        const isPages = /\.github\.io$/.test(location.hostname) || location.hostname === 'github.io';
        window.__DEMO__ = DEMO;
        window.__BYOK__ = BYOK;

        if (DEMO) {
          const _fetch = window.fetch.bind(window);
          window.fetch = (input, init) => {
            const s = String(input);
            if (s.includes('/api') || s.includes('openai.com')) {
              console.warn('Demo mode blocks API calls to:', s);
              return Promise.reject(new Error('Demo mode blocks API calls'));
            }
            return _fetch(input, init);
          };
          document.documentElement.classList.add('demo');
        }

        if(BYOK){
          document.documentElement.classList.add('byok');
        }

        if (isPages && !DEMO) {
          addEventListener('DOMContentLoaded', () => {
            document.body.innerHTML =
              '<h2>🚫 GitHub Pages はデモ専用</h2><p><code>?demo=1</code> を付けてUIのみ試せます。本番はVercelへ。</p>';
          });
          throw new Error('Blocked on GitHub Pages (non-demo)');
        }
      })();
    </script>
    <link rel="stylesheet" href="styles.css">
    <script defer src="script.js"></script>
  </head>
  <body>
    <main class="app" data-theme="daybreak" data-chat-open="false" data-settings-open="false">
      <header class="topbar" role="banner">
        <button
          class="icon-button drawer-toggle"
          type="button"
          aria-label="スレッド一覧を開く"
          aria-expanded="false"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M4 6h16M4 12h12M4 18h16" vector-effect="non-scaling-stroke" />
          </svg>
        </button>
        <div class="profile">
          <div class="avatar" aria-hidden="true">
            <img class="avatar-image" alt="" decoding="async" hidden />
            <span class="avatar-initial">A</span>
          </div>
          <div class="identity">
            <span class="name">ふらっと</span>
            <span class="status">こんにちは</span>
          </div>
        </div>
        <button
          class="icon-button settings-toggle"
          type="button"
          aria-label="設定モーダルを開く"
          aria-haspopup="dialog"
          aria-expanded="false"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path
              d="M11.22 2.25c-.28-.83-1.44-.83-1.72 0l-.56 1.56a1 1 0 0 1-1.47.55l-1.35-.78c-.76-.44-1.6.41-1.16 1.16l.78 1.35a1 1 0 0 1-.55 1.47l-1.56.56c-.83.28-.83 1.44 0 1.72l1.56.56a1 1 0 0 1 .55 1.47l-.78 1.35c-.44.76.4 1.6 1.16 1.16l1.35-.78a1 1 0 0 1 1.47.55l.56 1.56c.28.83 1.44.83 1.72 0l.56-1.56a1 1 0 0 1 1.47-.55l1.35.78c.76.44 1.6-.4 1.16-1.16l-.78-1.35a1 1 0 0 1 .55-1.47l1.56-.56c.83-.28.83-1.44 0-1.72l-1.56-.56a1 1 0 0 1-.55-1.47l.78-1.35c.44-.76-.4-1.6-1.16-1.16l-1.35.78a1 1 0 0 1-1.47-.55l-.56-1.56Z"
              vector-effect="non-scaling-stroke"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M9.75 12a2.25 2.25 0 1 0 4.5 0 2.25 2.25 0 0 0-4.5 0Z"
              vector-effect="non-scaling-stroke"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </header>

      <div class="layer drawer-layer" data-role="drawer-layer">
        <div class="backdrop drawer-backdrop" data-action="close-drawer" aria-hidden="true"></div>
        <aside
          class="chat-drawer"
          aria-labelledby="drawer-title"
          aria-hidden="true"
          tabindex="-1"
        >
          <header class="drawer-header">
            <h2 id="drawer-title">チャットスレッド</h2>
            <button class="drawer-close icon-button" type="button" data-action="close-drawer" aria-label="スレッド一覧を閉じる">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M6 6 18 18M6 18 18 6" vector-effect="non-scaling-stroke" />
              </svg>
            </button>
          </header>
          <div class="drawer-actions">
            <button class="new-thread-button" type="button" data-action="create-thread">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M12 5v14M5 12h14" vector-effect="non-scaling-stroke" />
              </svg>
              <span>新規スレッド</span>
            </button>
          </div>
          <nav class="drawer-content" aria-label="既存スレッド一覧">
            <ol class="thread-list" role="list"></ol>
            <p class="thread-empty" hidden>まだスレッドがありません。新規スレッドを作成してください。</p>
          </nav>
        </aside>
      </div>

      <div class="layer settings-layer" data-role="settings-layer">
        <div class="backdrop settings-backdrop" data-action="close-settings" aria-hidden="true"></div>
        <section
          class="settings-modal"
          role="dialog"
          aria-modal="true"
          aria-labelledby="settings-title"
          aria-describedby="settings-description"
          aria-hidden="true"
          tabindex="-1"
        >
          <header class="settings-header">
            <div>
              <h2 id="settings-title">設定</h2>
              <p id="settings-description">チャットの動作とAIの情報を調整します。</p>
            </div>
            <button class="settings-close icon-button" type="button" data-action="close-settings" aria-label="設定を閉じる">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M6 6 18 18M6 18 18 6" vector-effect="non-scaling-stroke" />
              </svg>
            </button>
          </header>
          <form class="settings-form" autocomplete="off">
            <fieldset class="settings-section">
              <legend>AIの情報</legend>
              <label class="field">
                <span class="field-label">表示名</span>
                <input type="text" name="assistantName" placeholder="Aeris" value="Aeris" />
              </label>
              <label class="field">
                <span class="field-label">ローカル画像アップロード</span>
                <input type="file" name="avatarFile" accept="image/*" />
                <small class="field-support">
                  ファイルは1MB以下のPNG/JPEG/SVGを使用してください。
                  <span data-avatar-status>アップロード画像はまだありません。</span>
                </small>
                <div class="field-actions">
                  <button type="button" class="text-button" data-action="clear-avatar">アップロードをクリア</button>
                </div>
              </label>
            </fieldset>
            <fieldset class="settings-section">
              <legend>OpenAI 接続</legend>
              <label class="field byok-feature">
                <span class="field-label">API キー</span>
                <input
                  type="password"
                  name="apiKey"
                  placeholder="sk-..."
                  autocomplete="off"
                />
                <small class="field-support">ブラウザのローカルストレージにのみ保存されます。</small>
              </label>
              <label class="field">
                <span class="field-label">モデル</span>
                <select name="model">
                  <option value="gpt-4o-mini" selected>GPT-4o mini</option>
                  <option value="gpt-4.1">GPT-4.1</option>
                </select>
                <small class="field-support">実際に呼び出すOpenAIモデルを選択します。</small>
              </label>
              <label class="field">
                <span class="field-label">システムプロンプト</span>
                <textarea
                  name="systemPrompt"
                  rows="3"
                  placeholder="AIの性格や口調など"
                >あなたは親切なAIアシスタントです。常に日本語で、明るく前向きな口調で丁寧に回答してください。</textarea>
              </label>
            </fieldset>
            <div class="settings-actions">
              <button type="button" class="ghost-button" data-action="close-settings">キャンセル</button>
              <button type="submit" class="primary-button">保存</button>
            </div>
          </form>
        </section>
      </div>

      <section class="chat-thread" aria-label="チャットスレッド">
        <div class="chat-empty" role="status">メッセージを送信して会話を始めましょう。</div>
        <ol class="chat-messages" aria-live="polite"></ol>
      </section>

      <form class="composer" autocomplete="off">
        <label class="sr-only" for="message-input">メッセージ本文</label>
        <textarea
          id="message-input"
          name="message"
          rows="1"
          placeholder="メッセージを入力..."
          maxlength="2000"
          required
        ></textarea>
        <button class="send-button" type="submit" disabled>
                        <span>送信</span>
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M4.3 4.3 20 12 4.3 19.7l1.4-5.6 8.3-2.1-8.3-2.1z" vector-effect="non-scaling-stroke" />
          </svg>
        </button>
      </form>
    </main>
  </body>
</html>

